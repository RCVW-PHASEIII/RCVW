<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<meta name="keywords" content="gps, gpsd, performance">
<meta name="author" content="Eric S. Raymond &lt;esr@thysus.com">
<title>Where&#8217;s the Latency? Performance analysis of GPSes and GPSD</title>
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;-webkit-tap-highlight-color:transparent}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>

/* gpsd CSS customization. */
#header > h1:first-child,
body {
  color: #000;
}

.sidebarblock,
#toc.toc2 {
  background: #f8f8f8;
  border: 1px dashed #999;
}

.sidebarblock {
  display: inline-block;
  float: left;
  margin-right: 20px;
  margin-bottom: 20px;
}

#toctitle {
  display: none;
}

#content #toc.toc {
  background: inherit;
  border: none;
  padding: 0em;
}

#header,
#content,
#footnotes,
#footer {
  max-width: initial;
}

@media screen and (min-width: 768px) {
  body {
    --left-col: 15em;
  }

  #content #Menu {
    border: 1px dashed #999;
    bottom: 2px;
    left: 2px;
    margin: 0 20px 20px 0;
    position: absolute;
    top: 2px;
    width: var(--left-col);
  }

  #content #preamble,
  #content .sect1 {
    margin-left: calc(var(--left-col) + 22px);
  }
}
</style>
</head>
<body class="article">
<div id="header">
<h1>Where&#8217;s the Latency? Performance analysis of GPSes and GPSD</h1>
<div class="details">
<span id="author" class="author">Eric S. Raymond &lt;esr@thysus.com</span><br>
<span id="revnumber">version 2.4,</span>
<span id="revdate">27 January 2020</span>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div id="Menu" class="sidebarblock">
<div class="content">
<div class="paragraph">
<p><span class="image"><img src="../gpsd-logo-small.png" alt="Small gpsd Logo" width="105" height="126"></span><br>
<a href="../index.html">Home</a><br>
<a href="../faq.html">FAQ</a><br>
<a href="../xgps-sample.html">Screenshots</a><br>
<a href="../hardware.html">Hardware</a><br>
<a href="../for-vendors.html">For GPS Vendors</a><br>
<a href="../wishlist.html">Wish List</a><br>
<a href="../hall-of-shame.html">Hall of Shame</a><br>
<a href="../troubleshooting.html">Troubleshooting Guide</a><br>
<a href="../hacking.html">Hacker&#8217;s Guide</a><br>
<a href="../references.html">References</a><br>
<a href="../protocol-transition.html">Application Compatibility</a><br>
<a href="../history.html">History</a><br>
<a href="../future.html">Future</a><br></p>
</div>
<hr>
<div id="toc" class="toc">
<div id="toctitle" class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_abstract">Abstract</a></li>
<li><a href="#_what_can_we_measure_and_improve">What Can We Measure and Improve?</a></li>
<li><a href="#_per_sentence_profiling">Per-sentence profiling</a>
<ul class="sectlevel2">
<li><a href="#_modeling_the_reporting_chain">Modeling the reporting chain</a></li>
<li><a href="#_data_and_analysis">Data and Analysis</a></li>
</ul>
</li>
<li><a href="#_per_cycle_profiling">Per-cycle profiling</a>
<ul class="sectlevel2">
<li><a href="#_modeling_the_reporting_chain_2">Modeling the reporting chain</a></li>
<li><a href="#_data_and_analysis_2">Data and Analysis</a></li>
</ul>
</li>
<li><a href="#_conclusions">Conclusions</a>
<ul class="sectlevel2">
<li><a href="#_for_application_programmers">For Application Programmers</a></li>
<li><a href="#_for_manufacturer_claims">For Manufacturer Claims</a></li>
<li><a href="#_for_gpsd_as_a_time_service">For GPSD as a Time Service</a></li>
<li><a href="#_for_the_design_of_gpsd">For the Design of GPSD</a></li>
</ul>
</li>
<li><a href="#_revision_history">Revision History</a></li>
<li><a href="#_copying">COPYING</a></li>
</ul>
</div>
<hr>
<div class="paragraph">
<p><a href="http://www.catb.org/hacker-emblem/"><span class="image"><img src="../glider.png" alt="hacker emblem" width="55" height="55"></span></a><br>
<br>
<a href="https://validator.w3.org/check/referer"><span class="image"><img src="html5.png" alt="Valid HTML 5" width="88" height="31"></span></a></p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_abstract"><a class="link" href="#_abstract">Abstract</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many GPS manufacturers tout binary protocols more dense than NMEA and
baud rates higher than the NMEA-standard 4800 bps as ways to increase
GPS performance.  While working on <strong>gpsd</strong>, I became interested in
evaluating these claims, which have some implications for the design of
<strong>gpsd</strong>.  Later, the average and peak latency
became of interest for modeling the performance of GPS as a time
service. This paper discusses the theory and the results of profiling
the code, and reaches some conclusions about system tuning and latency
control.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_can_we_measure_and_improve"><a class="link" href="#_what_can_we_measure_and_improve">What Can We Measure and Improve?</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The most important characteristic of a GPS, the positional accuracy of
its fixes, is a function of the GPS system and receiver design; GPSD can
do nothing to affect it. However, a GPS fix has a timestamp, and the
transmission path from the GPS to a user application introduces some
latency (that is, delay between the time of fix and when it is available
to the user).</p>
</div>
<div class="paragraph">
<p>Latency could be significant source of position error for a GPS in
motion. It may also be a significant issue if the GPS is being used as a
high-precision time source.</p>
</div>
<div class="paragraph">
<p>This paper describes the results of two rounds of measurement using
different tools. Both yielded interesting results, and can usefully be
juxtaposed with one another.</p>
</div>
<div class="paragraph">
<p>The first round was performed in 2005 using a version of the code very
near 2.13. This was before the JSON protocol change and before GPSD
developed the capability to do automated cycle detection. Consequently
the statistics extracted were primarily timings of individual packets
coming over the wire from the GPS.</p>
</div>
<div class="paragraph">
<p>The second round was performed in 2011 using a version of the code
between 3.1 and 3.2. At this time GPSD was being evaluated as a
high-precision time source for use in measuring network latency and
checking the performance of NTP. The profiling tools built into GPSD had
been rebuilt with an emphasis on timing the entire GPS reporting cycle,
rather than individual packets.</p>
</div>
<div class="paragraph">
<p>Both the 2005 and 2011 rounds used the same consumer-grade sensor
attached via USB to a Linux machine via a USB link, reporting to gpsd
which is polled via sockets by a profiling application. In all cases the
GPS was stationary at approximately 40N 75W.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_per_sentence_profiling"><a class="link" href="#_per_sentence_profiling">Per-sentence profiling</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_modeling_the_reporting_chain"><a class="link" href="#_modeling_the_reporting_chain">Modeling the reporting chain</a></h3>
<div class="paragraph">
<p>Consider the whole transmission path of a TPV (position/velocity/time)
report from a GPS to the user or user application. It has the following
stages:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A TPV report is generated in the GPS</p>
</li>
<li>
<p>It is encoded (into NMEA or a vendor binary protocol) and buffered for
transmission via serial link.</p>
</li>
<li>
<p>The encoding is transmitted via serial link to a buffer in gpsd.</p>
</li>
<li>
<p>The encoding is decoded and translated into a notification in GPSD&#8217;s
protocol.</p>
</li>
<li>
<p>The GPSD-protocol notification is polled and read over a client
socket.</p>
</li>
<li>
<p>The GPSD-protocol notification is decoded by libgps and unpacked into
a session structure available to the user application.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is also relevant that consumer-grade GPSes do not expect to be
polled, but are designed to issue TPV reports on a fixed cycle time,
which we&#8217;ll call C and which is usually 1 second. gpsd expects this. A
few GPSes (notably SiRF-II-based ones) can be polled, and we might thus
be able to pull TPV reports out of them at a higher rate. gpsd doesn&#8217;t
do this; one question this investigation can address is whether there
would be any point to that.</p>
</div>
<div class="paragraph">
<p>At various times GPS manufacturers have promoted proprietary binary
protocols and transmission speeds higher than the NMEA-standard 4800bps
as ways to improve GPS performance. Obviously these cannot affect
positional accuracy; all they can change is the latency at stages 2, 3,
and 4.</p>
</div>
<div class="paragraph">
<p>The implementation of gpsd affects how much latency is introduced at
stage 4. The design of the gpsd protocol (in particular, the average and
worst-case size and complexity of a position/velocity/time report)
affects how much latency is introduced at stages 5 and 6.</p>
</div>
<div class="paragraph">
<p>At stages 5 and later, the client design and implementation matter a
lot. In particular, it matters how frequently the client samples the TPV
reports that gpsd makes available.</p>
</div>
<div class="paragraph">
<p>The list of stages above implies the following formula for expected
latency L, and a set of tactics for reducing it:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>L = C/2 + E1 + T1 + D1 + W + E2 + T2 + D2</pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>C/2 is the expected delay introduced by a cycle time of C (worst-case
delay would just be C). We can decrease this by decreasing C, but
consumer-grade GPSes don&#8217;t go below 1 second.</p>
</li>
<li>
<p>E1 is TPV encoding time within the GPS. We can&#8217;t affect this.</p>
</li>
<li>
<p>T1 is transmission time over the serial link. We can decrease this by
raising the baud rate or increasing the information density of the
encoding.</p>
</li>
<li>
<p>D1 is decode time required for gpsd to update its session structure.
We can decrease this, if need be, by tuning the implementation or using
faster hardware.</p>
</li>
<li>
<p>W is the wait until the application polls gpsd. This can only be
reduced by designing the application to poll frequently.</p>
</li>
<li>
<p>E2 is TPV encoding time within the daemon. We can speed this up with
faster hardware or a simpler GPSD format.</p>
</li>
<li>
<p>T2 is transmission time over the client socket. Faster hardware, a
better TCP/IP stack or a denser encoding can decrease this.</p>
</li>
<li>
<p>D2 is decoding time required for the client library to update the
session structure visible to the user application. A simpler GPSD format
could decrease this</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The total figure L is of interest, of course. The first question to ask
is how it compares to C. But to know where tuning this system is worth
the effort and where it isn&#8217;t, the relative magnitude of these six
components is what is important. In particular, if C or E1 dominate,
there is no point in trying to tune the system at all.</p>
</div>
<div class="paragraph">
<p>The rule on modern hardware is that computation is cheap, communication
is expensive. By this rule, we expect E1, D1, E2, and D2 to be small
relative to T1 and T2. We can&#8217;t predict W. Thus there is no knowing how
the sum of the other terms will compare to C, but we know that E1 + T1
is the other statistic GPS vendors can easily measure. C &lt; E1 + T1 would
be a bad idea, and we can guess that competition among GPS vendors will
probably tend to push C downwards to the point where it&#8217;s not much
larger than E1 + T1.</p>
</div>
<div class="paragraph">
<p>C is known from manufacturer specifications. gpsd and its client
libraries can be built with profiling code that measures all the other
timing variables. The tool gpsprof1 collects this data and generates
reports and plots from it. There are, however, some sources of error to
be aware of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Our way of measuring E1 and T1 is to collect a timestamp on the first
character read of a new NMEA sentence, then on the terminating newline,
and compare those to the GPS timestamp on the sentence. While this will
measure E1+T1 accurately, it will underestimate the contribution of T1
to the whole because it doesn&#8217;t measure RS232 activity taking place
before the first character becomes visible at the receive end.</p>
</li>
<li>
<p>Because we compare GPS sentence timestamps with local ones, inaccuracy
in the computer&#8217;s clock fuzzes the measurements. The test machine
updated time from NTP, so the expected inaccuracy from this source
should be not more than about ten milliseconds.</p>
</li>
<li>
<p>The $ clause that the daemon uses to ship per-sentence profiling info
to the client adds substantial bulk to the traffic. Thus, it will tend
to inflate E2, T2, and D2 somewhat.</p>
</li>
<li>
<p>The client library used for profiling is written in Python, which will
further inflate D2 relative to the C client library most applications
are likely to use.</p>
</li>
<li>
<p>The system-call overhead of profiling (seven gettimeofday2 calls per
sentence to collect timestamps, several other time-library calls per
sentence to convert ISO8661 timestamps) will introduce a small amount of
noise into the figures. These are cheap calls that don&#8217;t induce disk
activity; thus, on modern hardware; we may expect the overhead per call
to be at worst in the microsecond range. The entire per-sentence
overhead system-call overhead should be on the order of ten
microseconds.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_data_and_analysis"><a class="link" href="#_data_and_analysis">Data and Analysis</a></h3>
<div class="paragraph">
<p>I took measurements using a Haicom 204s USB GPS mouse. This device,
using a SiRF-II GPS chipset and PL2303 USB-to-serial chipset, is very
typical of 2005&#8217;s consumer-grade GPS hardware; the Haicom people
themselves estimated to me in late 2004 that the SirF-II had about 80%
and rising market share, and the specification sheets I find with Web
searches back this up. Each profile run used 100 samples.</p>
</div>
<div class="paragraph">
<p>My host system for the measurements was an Opteron 3400 running an
"everything" installation of Fedora Core 3. This was still a moderately
fast machine in early 2005, but average processor utilization remained
low throughout the tests.</p>
</div>
<div class="paragraph">
<p>The version of the GPSD software I used for the test was released as
2.13. It was configured with <strong>--enable-profiling</strong>. All graphs and
figures were generated with gpsprof1, a tool built for this purpose and
included in the distribution.</p>
</div>
<div class="paragraph">
<p>One of the effects of building with <strong>--enable-profiling</strong> is that a
form of the B command that normally just reports the RS232 parameters
can be used to set them (it ships a SiRF-II control string to the GPS
and then changes the line settings).</p>
</div>
<div class="paragraph">
<p>Another effect is to enable a Z command to switch on profiling. When
profiling is on, each time gpsd reports a fix with timestamp (e.g. on
GPGGA, GPRMC and GPGLL sentences) it also reports timing information
from five checkpoints inside the daemon. The client library adds two
more checkpoints.</p>
</div>
<div class="paragraph">
<p>Our first graph is with profile reporting turned off, to give us a
handle on performance with the system disturbed as little as possible.
This was generated with <code>gpsprof  -t "Haicom 204s" -T png -f
uninstrumented -s 4800</code>. We&#8217;ll compare it to later plots to see the
effect of profiling overhead.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="graph1.png" alt="Total latency">
</div>
</div>
<div class="paragraph">
<p>Uninstrumented total latency is simply the delta from the GPS timestamp
associated with the packet to the arrival time of the end of the packet
at the profiling client. The repeated stairstep effect is because all
packets in a reporting cycle have the same timestamp; thus, the impulses
cumulate time in the reporting cycle so far.</p>
</div>
<div class="paragraph">
<p>The first thing to notice here is that the fix latency can be just over
a second; you can see the exact figures in the <a href="profile1.txt">raw
data</a>. Where is the time going? Our next graph was generated with
<code>gpsprof -T png -t
"Haicom 204s" -f raw -s 4800</code></p>
</div>
<div class="imageblock">
<div class="content">
<img src="graph2.png" alt="Instrumented latency report">
</div>
</div>
<div class="paragraph">
<p>As in the previous graph, each group of three lines is a single GPS
reporting cycle. By comparing this graph to the previous one, it is
pretty clear that the profiling reports are not introducing any
measurable latency. But what is more interesting is to notice that D1<br>
W + E2 + T2 + D2 vanishes&#8201;&#8212;&#8201;at this timescale, all we can see is E1
and T1.</p>
</div>
<div class="paragraph">
<p>The <a href="profile2.txt">raw data</a> bears this out. All times besides E1 and
T1 are so small that they are comparable to the noise level of the
measurements. This may be a bit surprising unless one knows that a W
near 0 is expected in this setup; gpsprof sets watcher mode. Also, a
modern zero-copy TCP/IP stack like Linux&#8217;s implements local sockets with
very low overhead. It is also a little surprising that E1 is so large
relative to E1+T1. Recall, however, that this may be measurement error.</p>
</div>
<div class="paragraph">
<p>Our third graph (<code>gpsprof  -t "Haicom 204s" -T png -f split -s 4800</code>
changes the presentation so we can see how latency varies with sentence
type.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="graph3.png" alt="Split latency report">
</div>
</div>
<div class="paragraph">
<p>The reason for the comb pattern in the previous graphs is now apparent;
latency is constant for any given sentence type. The obvious correlate
would be sentence length&#8201;&#8212;&#8201;but looking at the <a href="profile3.txt">raw
data</a>, we see that that is not the only factor. Consider this table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sentence type</th>
<th class="tableblock halign-left valign-top">Typical length</th>
<th class="tableblock halign-left valign-top">Typical latency</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPRMC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">70</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.01</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPGGA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.23</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPGLL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">49</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.31</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For illustration, here are some sample NMEA sentences logged while I was
conducting these tests:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$GPRMC,183424.834,A,4002.1033,N,07531.2003,W,0.00,0.00,170205,,*11
$GPGGA,183425.834,4002.1035,N,07531.2004,W,1,05,1.9,134.7,M,-33.8,M,0.0,0000*48
$GPGLL,4002.1035,N,07531.2004,W,183425.834,A*27</pre>
</div>
</div>
<div class="paragraph">
<p>Though GPRMCs are shorter than GPGAs, they consistently have an
associated latency four times as long. The graph tells us most of this
is E1. There must be something the GPS is doing that is computationally
very expensive when it generates GPRMCs. It may well be that it is
actually doing that fix at that point in the send cycle and buffering
the results for retransmission in GPGGA and GPGLL forms. Alternatively,
perhaps the speed/track computation is expensive.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s look at how the picture changes when we double the baud rate.
<code>gpsprof -t "Haicom 204s" -T png -s 9600</code> gives us this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="graph4.png" alt="Split latency report&#8201;&#8212;&#8201;9600bps">
</div>
</div>
<div class="paragraph">
<p>This graph looks almost identical to the previous one, except for
vertical scale&#8201;&#8212;&#8201;latency has been cut neatly in half. Transmission
times for GPRMC go from about 0.15sec to 0.075sec. Oddly, average E1 is
also cut almost in half. I don&#8217;t know how to explain this, unless a lot
of what looks like E1 is actually RS232 transmission time spent before
the first character appears in the daemon&#8217;s receive buffers. You can
also view the <a href="profile4.txt">raw data</a>.</p>
</div>
<div class="paragraph">
<p>For comparison, here&#8217;s the same plot made with a BU303b, a different USB
GPS mouse using the same SiRF-II/PL2303 combination:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="graph5.png" alt="Split latency report&#8201;&#8212;&#8201;9600bps">
</div>
</div>
<div class="paragraph">
<p>This, and the <a href="profile5.txt">raw data</a>, look very similar to the
Haicom numbers. The main difference seems to be that the BU303b firmware
doesn&#8217;t ship GPGLL by default.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_per_cycle_profiling"><a class="link" href="#_per_cycle_profiling">Per-cycle profiling</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_modeling_the_reporting_chain_2"><a class="link" href="#_modeling_the_reporting_chain_2">Modeling the reporting chain</a></h3>
<div class="paragraph">
<p>When the old GPSD protocol was replaced by an application of JSON and
the daemon developed the capability to perform automatic detection of
the beginning and end of GPS reporting cycles, it became possible to
measure whole-cycle latency. Also, embedding timing statistics in the
JSON digest of an entire cycle rather than as a $ sentence after each
GPS packet significantly reduced the overhead of profiling in the report
stream.</p>
</div>
<div class="paragraph">
<p>The model for these measurements is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A TPV report is generated in the GPS (at time 'T')</p>
</li>
<li>
<p>It is encoded into a burst of sentences in NMEA or a vendor binary
protocol and buffered for transmission via serial link.</p>
</li>
<li>
<p>The encoding is transmitted via serial link to a buffer in gpsd,
beginning at a time we shall call 'S'.</p>
</li>
<li>
<p>Because it consists of multiple packets, a period combining serial
transmission time with gpsd processing (packet-sniffing and analysis)
time will follow.</p>
</li>
<li>
<p>At the end of this interval (at a time we shall call 'E'), gpsd has
seen the GPS data it needs and is ready to produce a report to ship to
clients.</p>
</li>
<li>
<p>Meanwhile, the GPS may still be transmitting data that GPSD does not
use. But when the transmission burst is done, there will be quiet time
on the link (exception: as we noted in 2005, some devices' transmissions
may slightly overflow the 1-second cycle time at 4800bps).</p>
</li>
<li>
<p>The JSON report is shipped, arriving at the client at a time we shall
call 'R'.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We cannot know T directly. The GPS&#8217;s timestamp on the fix will tell us
when it thinks T was, but because we don&#8217;t know how our local clock
diverges from GPS&#8217;s atomic-clock timebase we don&#8217;t actually know what T
was in system time (call that T'). If we trust NTP, we then believe that
the skew between T and T' is no more than 10ms.</p>
</div>
<div class="paragraph">
<p>We catch time S by recording system time each time data becomes
available from the device. If adjacent returns of select(2) are
separated by more than 250msec, we have good reason to believe that the
second one follows end-of-cycle quiet time. This guard interval is
reliable at 9600bps and will only be more so at higher speeds.</p>
</div>
<div class="paragraph">
<p>We catch time E just before a JSON report is generated from the
per-device session structures. This is the wnd of the analysis phase. If
timing is enabled, extra members carrying S, E and the number of
characters transmitted during the cycle &#169; are included in the JSON.</p>
</div>
<div class="paragraph">
<p>We catch time R by noting when the JSON arrives at the client.</p>
</div>
<div class="paragraph">
<p>We know that the transmission-time portion of [S, E] can be approximated
by the formula (C * 10) / B where B is the transmission rate in bits per
second. (Each character costs 8 bits plus one parity bit plus one stop
bit.)</p>
</div>
<div class="paragraph">
<p>Knowing this, we can subtract (C * 10) / B from (E-S) to approximate the
internal processing time spent by gpsd. Due to other UART overheads,
this formula will slightly underestimate transmission time and this
overestimate processing time, but even a rough comparison of the two is
interesting.</p>
</div>
</div>
<div class="sect2">
<h3 id="_data_and_analysis_2"><a class="link" href="#_data_and_analysis_2">Data and Analysis</a></h3>
<div class="paragraph">
<p>With the new profiling tools, one graph (made with
<strong>gpsprof -f instrumented -n 100 -T png</strong>) tells the story. This is from
the same Haicom 204s used in the 2005 tests. You can see the exact
figures in the <a href="profile6.txt">raw data</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="graph6.png" alt="Per-cycle latency report&#8201;&#8212;&#8201;19200bps">
</div>
</div>
<div class="paragraph">
<p>Fix latency (S - T, the purple time segment in each sample) is
consistently about 120msec. Some of this represents on-chip processing.
Some may represent actual skew between NTP time and GPS time.</p>
</div>
<div class="paragraph">
<p>RS232 time (the blue segment) is the character transmission time
estimate we computed. It seems relatively steady at around 125ms. This
is probably a bit low, proportionately speaking.</p>
</div>
<div class="paragraph">
<p>The green segment is (E-S) with RS232 computed time subtracted. It
approximates the time required by gpsd for itelf. It seems steady at
around 15ms. This is probably a bit high, proportionately speaking.</p>
</div>
<div class="paragraph">
<p>The red dots that are just barely visible at the tops of some sample
bars represent R-E, the client reception delta. Inspection of the raw
data reveals that it is on the close order of 1ms.</p>
</div>
<div class="paragraph">
<p>Total fix latency is steady at about 310ms. Transmission time dominates.</p>
</div>
<div class="paragraph">
<p>It is instructive to compare this with the graph (and the
<a href="profile7.txt">raw data</a>) from the same device at 9600bps.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="graph7.png" alt="Per-cycle latency report&#8201;&#8212;&#8201;9600bps">
</div>
</div>
<div class="paragraph">
<p>As we might expect, RS232 time changes drastically and the other
components barely change at all. This gives us reason to be confident
that computed RS232 time is in fact tracking actual transmission time
pretty closely. It also confirms that the most effective way to decrease
total fix latency is simply to bump up the transmission speed.</p>
</div>
<div class="paragraph">
<p>It is equally instructive to compare these graphs with graphs taken from
the same GPS, at the same speed, running in NMEA rather than vendor
binary mode. Consider, for example, these:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="graph8.png" alt="Per-cycle latency report NMEA mode&#8201;&#8212;&#8201;9600bps">
</div>
</div>
<div class="paragraph">
<p>(Raw data is <a href="profile8.txt">here</a>.)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="graph9.png" alt="Per-cycle latency report NMEA mode&#8201;&#8212;&#8201;19200bps">
</div>
</div>
<div class="paragraph">
<p>(Raw data is <a href="profile8.txt">here</a>.)</p>
</div>
<div class="paragraph">
<p>The comb-shaped pattern in these graphs reflect the additional
transmission time for $GPGSV every 5 cycles. We can see clearly that the
vendor binary protocol does not significantly cut either the latency or
the total bandwidth required.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusions"><a class="link" href="#_conclusions">Conclusions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>All these conclusions apply to the consumer-grade GPS hardware generally
available back in 2005 and today in 2011, e.g. with a cycle time of one
second. As it happens, 2005 was just after the point when consumer-grade
GPS chips stabilized as a technology, and though unit prices have fallen
they have changed relatively little in technology and performance over
the intervening six years. The main improvement has been in sensitivity,
improving operation with a poor skyview but not affecting the timing
characteristics of the output.</p>
</div>
<div class="sect2">
<h3 id="_for_application_programmers"><a class="link" href="#_for_application_programmers">For Application Programmers</a></h3>
<div class="paragraph">
<p>For the best tradeoff between minimizing latency and use of application
resources, an argument similar to Nyquist&#8217;s Theorem tells us to poll
gpsd once every half-cycle&#8201;&#8212;&#8201;that is, on almost all GPSes at time of
writing, twice a second.</p>
</div>
<div class="paragraph">
<p>With the SiRF chips still used in most consumer-grade GPSes at time of
writing, 9600bps is the optimal line speed. 4800 is slightly too low,
not guaranteeing updates within the 1-second cycle time. 9600bps yields
updates in about 0.45sec, 19600bps in about 0.26sec. Higher speeds would
probably not be worth the extra computation unless your sensor is in
rapid motion. Even whole-cycle latency, most sensitive to transmission
speed, is only cut by less than 200ms by going to 19200. Higher speed
will exhibit diminishing returns.</p>
</div>
<div class="paragraph">
<p>Comparing the SiRF-II performance at 4800bps and 9600 shows a drop in
E1+T1 that looks about linear, suggesting that for a cycle of n seconds,
the optimal line speed would be about 9600/n. Since future GPS chips are
likely to have faster processors and thus less latency, this may be
considered an upper bound on useful line speed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_for_manufacturer_claims"><a class="link" href="#_for_manufacturer_claims">For Manufacturer Claims</a></h3>
<div class="paragraph">
<p>Because 9600bps is readily available, the transmission- and decode-time
advantages of binary protocols over NMEA are not significant within a
1-per-second update cycle. Because line speeds up to 38400 are readily
available through standard UARTs, we may expect this to continue to be
the case even with cycle times as low as 0.25sec.</p>
</div>
<div class="paragraph">
<p>More generally, binary protocols are largely pointless except as
market-control devices for the manufacturers. The additional
capabilities they support could be just as effectively supported through
NMEA&#8217;s $P-prefix extension mechanism.</p>
</div>
</div>
<div class="sect2">
<h3 id="_for_gpsd_as_a_time_service"><a class="link" href="#_for_gpsd_as_a_time_service">For GPSD as a Time Service</a></h3>
<div class="paragraph">
<p>We have measured a typical intrisic time latency of about 70msec due to
on-GPS processing and the USB polling interval. While this is noticeably
higher than NTP&#8217;s expected accuracy of ±10msec, it should be adequate
for most applications other than physics experiments.</p>
</div>
</div>
<div class="sect2">
<h3 id="_for_the_design_of_gpsd"><a class="link" href="#_for_the_design_of_gpsd">For the Design of GPSD</a></h3>
<div class="paragraph">
<p>In 2005, I wrote that gpsd does not introduce measurable latency into
the path from GPS to application. I said that cycle times would have to
decrease by two orders of magnitude for this to change.</p>
</div>
<div class="paragraph">
<p>In 2011, with better whole-cycle oriented profiling tools and a faster
test machine, latency incurred by gpsd can be measured. It is less than
15ms sec on a 2.66 Intel Core Duo under normal load. How much less
depends on how much the model computations underestimate RS232
transmission time for the GPS data.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_revision_history"><a class="link" href="#_revision_history">Revision History</a></h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Revision</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Author</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25 January 2020</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">gem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert from DocBook to AsciiDoc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25 November 2011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">esr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Typo fixes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30 September 2011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">esr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fix errors in some whole-cycle visualizations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">29 September 2011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">esr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Revisions as suggested by Hal Murray.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">23 September 2011</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">esr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update to include whole-cycle profiling.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">27 September 2009</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">esr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Endnote about the big protocol change.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 January 2008</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">esr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Typo fixes and clarifications for issues raised by Bruce Sutherland.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21 February 2005</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">esr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial draft.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_copying"><a class="link" href="#_copying">COPYING</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This file is Copyright 2005 by the GPSD project
This file is Copyright 2005 by Eric S. Raymond
SPDX-License-Identifier: BSD-2-clause</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.4<br>
Last updated 2023-01-10 17:38:26 -0500
</div>
</div>
</body>
</html>